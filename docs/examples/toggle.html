<!DOCTYPE html>
<html>
<head>
  <script src="../El.js"></script>
  <script>
    /* Helper function to convert a string to a boolean */
    function strToBool(str){
      if(!str) return false;
      if(typeof(str) == "boolean") return str;
      return !!(["true", "t", "yes", "y", "on"].indexOf( str.toLowerCase() ) > -1);
    };
    El("my-toggle", {
      attached: function(){ // "this" is the element that was attached to the DOM
        var disabled = this.getAttribute("disabled");
        if(!disabled && disabled != "") this.setAttribute("tabindex", "0");
        this.$input = document.createElement("input");
        this.$input.setAttribute("type", "hidden");
        this.$input.value = this.getAttribute("value") || false;
        var name = this.getAttribute("name");
        if(name) this.$input.setAttribute("name", name);
        this.appendChild(this.$input);
        Object.defineProperty(this, "value", {
          get: function(){
            return strToBool(this.getAttribute("value"));
          },
          set: function(val){
            this.setAttribute("value", val);
          }
        })
        this.value = this.value;
        this.addEventListener("mousedown", function(){
          this.value = !strToBool(this.value);
        });
        this.addEventListener("keydown", function(e){
          if(e.keyCode == 32){ // spacebar
            this.value = !strToBool(this.value);
            e.preventDefault();
            return false;
          } else if(e.keyCode == 13 && Element.prototype.closest){ // enter
            /*
              This will not work in IE because they dont support "closest"
              But there is a polyfill
              https://developer.mozilla.org/en-US/docs/Web/API/Element/closest
            */
            var form = this.closest("form")
            if(form) form.submit();
          }
        });
      },
      changed: function(changes){
        if(changes.attributes && changes.attributes.disabled){
          if(changes.attributes.disabled.value == null) this.setAttribute("tabindex", "0");
          else this.removeAttribute("tabindex");
        }
        if(changes.attributes && changes.attributes.value){
          this.$input.value = changes.attributes.value.value;
        }
        if(changes.attributes && changes.attributes.name){
          this.$input.setAttribute("name", changes.attributes.name.value);
        }
      },
      watch: {
        attributes: ["disabled", "value", "name"]
      }
    });
  </script>
  <style>
    my-toggle {
      display: inline-block;
      width: 64px;
      height: 32px;
      margin: 8px;
      border-radius: 16px;
      background-color: #c0c0c0;
      position: relative;
      cursor: pointer;
      transition: background-color 0.4s, box-shadow 0.4s;
      box-shadow: 0 0 0 transparent;
      outline: none;
    }
    my-toggle:focus {
      box-shadow: 0 0 2px 1px #3366ff;
    }
    my-toggle::before {
      content: '';
      display: block;
      width: 28px;
      height: 28px;
      border-radius: 14px;
      position: absolute;
      top: 2px;
      left: 2px;
      background-color: white;
      transition: left 0.4s;
    }
    my-toggle[value="true"] {
      background-color: green;
    }
    my-toggle[value="true"]::before {
      left: 34px;
    }
    my-toggle[disabled] {
      pointer-events: none;
      opacity: 0.6;
    }
  </style>
</head>
<body>
  <form>
    <my-toggle id='tog' name="MyTog"></my-toggle>
    <br>
    <button type="button" onclick='document.getElementById("tog").setAttribute("disabled", "");'>Disable Toggle</button>
    <button type="button" onclick='document.getElementById("tog").removeAttribute("disabled");' >Enable Toggle</button>
    <br>
    <button type="submit">Submit</button>
  </form>
  <div id='add'></div>
  <button onclick='document.getElementById("add").appendChild(document.createElement("my-toggle"))'>Add another toggle</button>
</body>
</html>
