<!DOCTYPE html>
<html>
<head>
  <title>Toggle - Kempo Example</title>
  <script src='../Kempo.js'></script>
  <script>
    /* Helper function to convert a string to a boolean */
    function strToBool(str){
      if(!str) return false;
      if(typeof(str) == "boolean") return str;
      return !!(["true", "t", "yes", "y", "on"].indexOf( str.toLowerCase() ) > -1);
    };
    /* Define a new custom element that uses the "my-person" tag */
    Kempo("my-toggle", {
      // When a new "my-toggle" element is attached to the DOM
      attached: function(){
        // Determine if it is disabled
        var disabled = this.getAttribute("disabled");

        // If it is not disabled then allow it to be focused
        if(!disabled && disabled != "") this.setAttribute("tabindex", "0");

        /*  Create a hidden input within in which allows it to be submitted
              in forms */
        this.$input = document.createElement("input"); // Create the input
        this.$input.setAttribute("type", "hidden"); // Make it hidden
        // Set its value
        this.$input.value = strToBool(this.getAttribute("value")) || false;
        var name = this.getAttribute("name"); // Get the name
        if(name) // If tere is a name
          this.$input.setAttribute("name", name); // Give it to the hidden input
        this.appendChild(this.$input); // Append the input

        // Define a custom "value" member
        Object.defineProperty(this, "value", {
          get: function(){ // When the attribute is gotten
            // Return it as a boolean
            return strToBool(this.getAttribute("value"));
          },
          set: function(val){ // When the attribute is set
            // Set the value attribute
            this.setAttribute("value", val);
          }
        });
        this.value = this.value; // Set the inital value

        // When the element is clicked
        this.addEventListener("mousedown", function(){
          // Toggle the value
          this.value = !strToBool(this.value);
        });

        // Listen for key presses
        this.addEventListener("keydown", function(e){
          if(e.keyCode == 32){ // When the spacebar is pressed
            this.value = !strToBool(this.value); // Toogle the value

            /*  Prevent the default "spacebar" behavior, which is the page
                  scrolling by 100vh on most browsers */
            e.preventDefault(); // Prevent on most browsers
            return false; // Prevent on IE < 11

          } else if(e.keyCode == 13 && Element.prototype.closest){
            /*  When the enter key is pressed, and we can find the closes
                  parent form
                This will not work in IE because they dont support "closest"
                  But there is a polyfill
              https://developer.mozilla.org/en-US/docs/Web/API/Element/closest
            */
            var form = this.closest("form"); // Get the closest parent form
            if(form) form.submit(); // If it is in a form, submit the form
          }
        });
      },
      watch: { // Watch for these attributes changing
        attributes: ["disabled", "value", "name"]
      },
      changed: function(changes){

        // When the disabled attribute changes
        if(changes.attributes && changes.attributes.disabled){
          // When it is enabled
          if(changes.attributes.disabled.value == null)
            // Allow it to be focused
            this.setAttribute("tabindex", "0");
          else // When it becomes disabled
            this.removeAttribute("tabindex"); // Dont allow it to be focused
        }

        // When the value is changed
        if(changes.attributes && changes.attributes.value){
          // Update the inputs value
          this.$input.value = changes.attributes.value.value;
        }

        // When the name changes
        if(changes.attributes && changes.attributes.name){
          // Update the hidden inputs name
          this.$input.setAttribute("name", changes.attributes.name.value);
        }
      }
    });
  </script>
  <style>
    /* Some Styles to make the toggle look decent */
    my-toggle {
      display: inline-block;
      width: 64px;
      height: 32px;
      margin: 8px;
      border-radius: 16px;
      background-color: #c0c0c0;
      position: relative;
      cursor: pointer;
      transition: background-color 0.4s, box-shadow 0.4s;
      box-shadow: 0 0 0 transparent;
      outline: none;
    }
    my-toggle:focus {
      box-shadow: 0 0 2px 1px #3366ff;
    }
    my-toggle::before {
      content: '';
      display: block;
      width: 28px;
      height: 28px;
      border-radius: 14px;
      position: absolute;
      top: 2px;
      left: 2px;
      background-color: white;
      transition: left 0.4s;
    }
    my-toggle[value="true"] {
      background-color: green;
    }
    my-toggle[value="true"]::before {
      left: 34px;
    }
    my-toggle[disabled] {
      /* Do not allow the toggle to be clicked when disabled */
      pointer-events: none;
      opacity: 0.6;
    }
  </style>
</head>
<body>
  <!-- Create a new "my-toggle" within a form -->
  <form>
    <my-toggle id='tog' name="MyTog"></my-toggle>
    <br>
    <button type="button" onclick='document.getElementById("tog").setAttribute("disabled", "");'>Disable Toggle</button>
    <button type="button" onclick='document.getElementById("tog").removeAttribute("disabled");' >Enable Toggle</button>
    <br>
    <button type="submit">Submit</button>
  </form>
  <div id='add'></div>
  <button onclick='document.getElementById("add").appendChild(document.createElement("my-toggle"))'>Add another toggle</button>
</body>
</html>
