<!DOCTYPE html>
<html>
<head>
  <script src='../El.js'></script>
  <script>
    El("x-gallery", {
      attached: function(){
        this.sources = [].slice.call(this.querySelectorAll("img")).map(function(el){
          return el.getAttribute("src");
        });
        var index = 0;
        this.style.backgroundImage = "url("+this.sources[index]+")";
        var gallery = this;
        this.interval = setInterval(function(){
          index++;
          if(index >= gallery.sources.length) index = 0;
          gallery.style.backgroundImage = "url("+gallery.sources[index]+")";
        }, parseInt(this.getAttribute("timer")) || 5000);
      },
      changed: function(changes){
        console.log(changes);
        if(changes.children){
          for(var i=0; i<changes.children.added.length; i++){
            this.sources.push(changes.children.added[i].getAttribute("src"));
          }
        }
        if(changes.attributes && changes.attributes.timer){
          clearInterval(this.interval);
          var gallery = this;
          this.interval = setInterval(function(){
            index++;
            if(index >= gallery.sources.length) index = 0;
            gallery.style.backgroundImage = "url("+gallery.sources[index]+")";
          }, parseInt(this.getAttribute("timer")) || 5000);
        }
      },
      detached: function($element){
        delete $element.sources;
      },
      watch: {
        attributes: ["timer"],
        children: true
      }
    });
  </script>
  <style>
    x-gallery {
      display: block;
      width: 500px;
      height: 500px;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
    }
    x-gallery img {
      display: none;
    }
  </style>
</head>
<body>
  <x-gallery id='gallery'>
    <img src="img1.jpg" />
    <img src="img3.jpg" />
    <img src="img4.jpg" />
    <img src="img5.jpg" />
  </x-gallery>
  <form id='add-images'>
    <input id='add-image-url' placeholder='Image URL' />
    <button>Add To Gallery</button>
  </form>
  <script>
    document.getElementById("add-images").addEventListener("submit", function(e){
      var img = document.createElement("img");
      img.setAttribute("src", document.getElementById("add-image-url").value);
      document.getElementById("gallery").appendChild(img);
      document.getElementById("add-image-url").value = "";
      e.preventDefault();
      return false;
    })
  </script>
</body>
</html>
